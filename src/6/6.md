# 6ã€Menorepoå¤šæ¨¡å—å¼€å‘å®è·µ

å‰é¢5èŠ‚è¯¾é‡Œï¼Œæˆ‘ä»¬å·²ç»æŠŠä¸€ä¸ªNode.js + TSçš„å®Œæ•´é¡¹ç›®å¼€å‘è¿‡ç¨‹è®²å®Œäº†ï¼Œè™½ç„¶ä¸»è¦ä»¥Hello worldä¸ºä¸»ï¼Œç›¸ä¿¡å¯¹åˆå­¦è€…å­¦ä¹ æ¥è¯´è¶³å¤Ÿã€‚æœ¬ç« ä¸»è¦è®²è§£nodejs + ts åœ¨å¤šæ¨¡å—å¼€å‘åœºæ™¯ä¸‹çš„ç”¨æ³•ï¼Œä»¥åŠæœ€ä½³å®è·µï¼Œå¸Œæœ›æœ¬ç« èƒ½å¤Ÿåšåˆ°æ—¢å®ç”¨ï¼Œåˆèƒ½å¼€çœ¼ç•Œã€‚

Menorepoæ˜¯ä¸€ç§è½¯ä»¶å¼€å‘çš„æ–¹æ³•è®ºï¼Œå®ƒæŒ‡çš„æ˜¯å°†ä¸€ä¸ªå¤§å‹é¡¹ç›®æ‹†åˆ†æˆå¤šä¸ªå°å‹ä»“åº“è¿›è¡Œç®¡ç†çš„åšæ³•ã€‚æ¯ä¸ªå°å‹ä»“åº“éƒ½ä¸“æ³¨äºç‰¹å®šçš„åŠŸèƒ½æˆ–æ¨¡å—ï¼Œå¯ä»¥ç‹¬ç«‹å¼€å‘ã€æµ‹è¯•å’Œéƒ¨ç½²ã€‚é€šè¿‡ä½¿ç”¨Menorepoï¼Œå¼€å‘å›¢é˜Ÿå¯ä»¥æ›´å¥½åœ°åä½œã€æé«˜å¼€å‘æ•ˆç‡ï¼Œå¹¶ä¸”æ›´å®¹æ˜“å®ç°ä»£ç å¤ç”¨å’Œæ¨¡å—åŒ–ã€‚

å·¥ç¨‹é¢†åŸŸçš„è§£å†³æ–¹æ¡ˆæœ‰å¾ˆå¤šï¼Œæ¯”å¦‚Lernaã€yarn workspacesã€nxã€rushã€boltã€pnpm workspaceï¼Œç”šè‡³è¿˜æœ‰lerna-liteï¼Œè¶³è§å…¶æµè¡Œç¨‹åº¦ä¹‹ç«çˆ†ã€‚æ›´æœ‰ç”šè‡³ï¼ŒæŠŠå‰ç«¯åº”ç”¨å’ŒNode.jsåº”ç”¨æ”¾åˆ°ä¸€èµ·ï¼Œæ··ç€packageså»ç”¨ï¼ŒçœŸæ˜¯ä¸çŸ¥é“é—¹å¤šå¤§ç¬‘è¯ï¼Œä¸è¦ä¸ºäº†ç”¨è€Œç”¨ã€‚

æˆ‘ç†è§£Menorepoçš„å…¸å‹åœºæ™¯å¦‚ä¸‹ã€‚

- å‰ç«¯åº”ç”¨+ç»„ä»¶
- Node.jsåº”+ä¸­é—´ä»¶ã€çˆ¶å­åº”ç”¨
- ç»„ä»¶æˆ–ä¸­é—´ä»¶+ç¤ºä¾‹

åœ¨Node.jsä¸–ç•Œé‡Œï¼Œä½¿ç”¨å2è€…ç”¨çš„å…¶å®æ˜¯éå¸¸å¤šã€‚

# å¼€å‘ä½ çš„ç¬¬ä¸€ä¸ªæ¨¡å—

## åˆå§‹åŒ–

```tsx
$ git clone --depth 1 git@github.com:npmstudy/your-node-v20-menoreopo-project.git my-menorepo
Cloning into 'my-menorepo'...
remote: Enumerating objects: 52, done.
remote: Counting objects: 100% (52/52), done.
remote: Compressing objects: 100% (41/41), done.
remote: Total 52 (delta 2), reused 50 (delta 2), pack-reused 0
Receiving objects: 100% (52/52), 89.56 KiB | 181.00 KiB/s, done.
Resolving deltas: 100% (2/2), done.
```

åªå…‹éš†æœ€æ–°çš„ä»£ç ï¼Œæ— æ›´å¤šgit commitè®°å½•ã€‚

```tsx
$ rm -rf .git/
$ git init
Initialized empty Git repository in /Users/alfred/workspace/npmstudy/my-menorepo/.git/
$ git status
On branch main

No commits yet

Untracked files:
  (use "git add <file>..." to include in what will be committed)
	.changeset/
	.editorconfig
	.eslintignore
	.eslintrc.json
	.github/
	.gitignore
	.husky/
	.lintstagedrc.json
	.prettierignore
	.prettierrc.json
	.versionrc
	.vscode/
	LICENSE
	README.md
	commitlint.config.js
	docs/
	example/
	nx.json
	package.json
	packages/
	pnpm-lock.yaml
	pnpm-workspace.yaml
	tsconfig.json

nothing added to commit but untracked files present (use "git add" to track)
$ git add .
$ git commit -am 'init'
[main (root-commit) 73acfc8] init
 42 files changed, 7061 insertions(+)
 create mode 100644 .changeset/README.md
 create mode 100644 .changeset/config.json
 create mode 100644 .editorconfig
 create mode 100644 .eslintignore
 create mode 100644 .eslintrc.json
 create mode 100644 .github/workflows/ci.yml
 create mode 100644 .github/workflows/release.yml
 create mode 100644 .gitignore
 create mode 100755 .husky/commit-msg
 create mode 100755 .husky/pre-commit
 create mode 100755 .husky/pre-push
 create mode 100644 .lintstagedrc.json
 create mode 100644 .prettierignore
 create mode 100644 .prettierrc.json
 create mode 100644 .versionrc
 create mode 100644 .vscode/extensions.json
 create mode 100644 LICENSE
 create mode 100644 README.md
 create mode 100644 commitlint.config.js
 create mode 100644 docs/.gitignore
 create mode 100644 example/package.json
 create mode 100644 example/src/app.ts
 create mode 100644 example/tsconfig.json
 create mode 100644 example/tsconfig.node.json
 create mode 100644 example/vite.config.cjs
 create mode 100644 nx.json
 create mode 100644 package.json
 create mode 100644 packages/lib/package.json
 create mode 100644 packages/lib/src/__tests__/index.test.ts
 create mode 100644 packages/lib/src/index.ts
 create mode 100644 packages/lib/tsconfig.json
 create mode 100644 packages/lib/tsup.config.cjs
 create mode 100644 packages/lib/vitest.config.cjs
 create mode 100644 packages/lib2/package.json
 create mode 100644 packages/lib2/src/__tests__/index.test.ts
 create mode 100644 packages/lib2/src/index.ts
 create mode 100644 packages/lib2/tsconfig.json
 create mode 100644 packages/lib2/tsup.config.cjs
 create mode 100644 packages/lib2/vitest.config.cjs
 create mode 100644 pnpm-lock.yaml
 create mode 100644 pnpm-workspace.yaml
 create mode 100644 tsconfig.json
```

ç„¶åé…ç½®ä½ è‡ªå·±çš„gitä»“åº“å³å¯ã€‚

## å®‰è£…ä¾èµ–

pnpmæ˜¯ä¸€ç§åŒ…ç®¡ç†å·¥å…·ï¼Œç±»ä¼¼äºnpmå’ŒYarnã€‚å®ƒçš„ä¸»è¦ç‰¹ç‚¹æ˜¯ä½¿ç”¨ç¡¬é“¾æ¥å’Œç¬¦å·é“¾æ¥æ¥å…±äº«ä¾èµ–é¡¹ï¼Œä»¥å‡å°‘ç£ç›˜ç©ºé—´çš„å ç”¨å’Œå®‰è£…æ—¶é—´ã€‚

pnpmçš„ä¸€äº›ä¼˜ç‚¹åŒ…æ‹¬ï¼š

1. ç£ç›˜ç©ºé—´å ç”¨æ›´å°ï¼šç”±äºä½¿ç”¨ç¡¬é“¾æ¥å’Œç¬¦å·é“¾æ¥æ¥å…±äº«ä¾èµ–é¡¹ï¼Œpnpmå¯ä»¥æ˜¾è‘—å‡å°‘æ¯ä¸ªé¡¹ç›®çš„ç£ç›˜ç©ºé—´å ç”¨ã€‚è¿™å¯¹äºMenorepoå’Œå¤šä¸ªé¡¹ç›®å…±äº«ç›¸åŒä¾èµ–é¡¹çš„æƒ…å†µç‰¹åˆ«æœ‰ç”¨ã€‚
2. å®‰è£…é€Ÿåº¦æ›´å¿«ï¼šç”±äºå…±äº«ä¾èµ–é¡¹ï¼Œpnpmå¯ä»¥åœ¨å®‰è£…è¿‡ç¨‹ä¸­è·³è¿‡é‡å¤çš„ä¾èµ–é¡¹ã€‚è¿™å¯ä»¥æ˜¾è‘—å‡å°‘å®‰è£…æ—¶é—´ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤šä¸ªé¡¹ç›®ä¹‹é—´å…±äº«ç›¸åŒä¾èµ–é¡¹çš„æƒ…å†µä¸‹ã€‚
3. æ›´å°‘çš„ç½‘ç»œæµé‡ï¼šç”±äºå…±äº«ä¾èµ–é¡¹ï¼Œpnpmåªéœ€è¦ä¸‹è½½ä¸€æ¬¡æ¯ä¸ªä¾èµ–é¡¹ï¼Œè€Œä¸æ˜¯æ¯ä¸ªé¡¹ç›®éƒ½ä¸‹è½½ä¸€æ¬¡ã€‚è¿™å¯ä»¥å‡å°‘ç½‘ç»œæµé‡çš„æ¶ˆè€—ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤šä¸ªé¡¹ç›®ä¹‹é—´å…±äº«ç›¸åŒä¾èµ–é¡¹çš„æƒ…å†µä¸‹ã€‚
4. å…¼å®¹æ€§ï¼špnpmä¸npmå’ŒYarnçš„ç”Ÿæ€ç³»ç»Ÿå…¼å®¹ï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨å®ƒä»¬çš„é…ç½®æ–‡ä»¶å’Œå‘½ä»¤ã€‚è¿™ä½¿å¾—è¿ç§»åˆ°pnpmç›¸å¯¹å®¹æ˜“ï¼Œè€Œä¸éœ€è¦å¯¹é¡¹ç›®è¿›è¡Œå¤§é‡çš„æ›´æ”¹ã€‚

pnpmæ˜¯ä¸€ä¸ªå¿«é€Ÿã€é«˜æ•ˆä¸”èŠ‚çœç©ºé—´çš„åŒ…ç®¡ç†å·¥å…·ï¼Œé€‚ç”¨äºå¤§å‹é¡¹ç›®å’ŒMenorepoã€‚

å®‰è£…pnpm

```tsx
$ npm i -g pnpm

added 1 package in 4s

1 package is looking for funding
  run `npm fund` for details
```

å®‰è£…ä¾èµ–

```tsx
$ pnpm i
Scope: all 3 workspace projects
Lockfile is up to date, resolution step is skipped
Packages: +819
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Progress: resolved 819, reused 819, downloaded 0, added 819, done
node_modules/.pnpm/nx@16.9.1/node_modules/nx: Running postinstall script, done in 988ms

dependencies:
+ @changesets/cli 2.26.2

devDependencies:
+ @commitlint/config-conventional 17.7.0
+ @size-limit/preset-small-lib 8.2.6
+ @types/node 18.17.9
+ @typescript-eslint/eslint-plugin 5.62.0
+ @typescript-eslint/parser 5.62.0
+ commitlint 17.7.1
+ concurrently 8.2.1
+ eslint 8.47.0
+ eslint-config-prettier 8.10.0
+ eslint-import-resolver-typescript 3.6.0
+ eslint-plugin-import 2.28.1
+ eslint-plugin-prettier 4.2.1
+ eslint-plugin-react 7.33.2
+ eslint-plugin-react-hooks 4.6.0
+ husky 8.0.3
+ lint-staged 13.3.0
+ nx 16.9.1
+ prettier 2.8.8
+ size-limit 8.2.6
+ tsup 7.2.0
+ tsx 3.12.10
+ typescript 4.9.5
+ vite 4.4.9
+ vitest 0.32.4

. prepare$ husky install
â”‚ husky - Git hooks installed
â””â”€ Done in 148ms
Done in 5.6s

```

## ç›®å½•ç»“æ„

```tsx
$ tree . -L 4 -I node_modules
.
â”œâ”€â”€ LICENSE
â”œâ”€â”€ README.md
â”œâ”€â”€ commitlint.config.js
â”œâ”€â”€ docs
â”œâ”€â”€ example
â”‚Â Â  â”œâ”€â”€ package.json
â”‚Â Â  â”œâ”€â”€ src
â”‚Â Â  â”‚Â Â  â””â”€â”€ app.ts
â”‚Â Â  â”œâ”€â”€ tsconfig.json
â”‚Â Â  â”œâ”€â”€ tsconfig.node.json
â”‚Â Â  â””â”€â”€ vite.config.cjs
â”œâ”€â”€ nx.json
â”œâ”€â”€ package-lock.json
â”œâ”€â”€ package.json
â”œâ”€â”€ packages
â”‚Â Â  â”œâ”€â”€ lib
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ package.json
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ src
â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ __tests__
â”‚Â Â  â”‚Â Â  â”‚Â Â  â””â”€â”€ index.ts
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ tsconfig.json
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ tsup.config.cjs
â”‚Â Â  â”‚Â Â  â””â”€â”€ vitest.config.cjs
â”‚Â Â  â””â”€â”€ lib2
â”‚Â Â      â”œâ”€â”€ package.json
â”‚Â Â      â”œâ”€â”€ src
â”‚Â Â      â”‚Â Â  â”œâ”€â”€ __tests__
â”‚Â Â      â”‚Â Â  â””â”€â”€ index.ts
â”‚Â Â      â”œâ”€â”€ tsconfig.json
â”‚Â Â      â”œâ”€â”€ tsup.config.cjs
â”‚Â Â      â””â”€â”€ vitest.config.cjs
â”œâ”€â”€ pnpm-lock.yaml
â”œâ”€â”€ pnpm-workspace.yaml
â””â”€â”€ tsconfig.json

10 directories, 24 files
```

è¯¥é¡¹ç›®åŒ…å«3ä¸ªå­é¡¹ç›®ï¼Œå…·ä½“å¦‚ä¸‹ã€‚

1. packages æ˜¯pnpm-workspace.yamlä¸­é…ç½®çš„ç›®å½•
    1. libæ˜¯ç¤ºä¾‹æ¨¡å—
    2. lib2æ˜¯ç¤ºä¾‹æ¨¡å—
2. exampleæ˜¯ç¤ºä¾‹ç›®å½•

## æ¨¡å—ä»£ç 

ç›®å½•ç»“æ„

```tsx
$ tree packages/lib/ -I node_modules
packages/lib/
â”œâ”€â”€ package.json
â”œâ”€â”€ src
â”‚Â Â  â”œâ”€â”€ __tests__
â”‚Â Â  â”‚Â Â  â””â”€â”€ index.test.ts
â”‚Â Â  â””â”€â”€ index.ts
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ tsup.config.cjs
â””â”€â”€ vitest.config.cjs

2 directories, 6 files
```

å…·ä½“ä»£ç 

![Untitled](img/Untitled.png)

è¦ç‚¹è¯´æ˜ã€‚

1. é‡‡ç”¨äº†Vitestä½œä¸ºæµ‹è¯•æ¡†æ¶ï¼Œè¿™æ˜¯å› ä¸ºå®ƒä¸ä¾èµ–Node.jsç‰ˆæœ¬
2. åœ¨package.jsoné‡Œæ²¡æœ‰é…ç½®type=moduleï¼Œè€Œæ˜¯æ”¯æŒcjså’ŒesmäºŒç§æ ¼å¼ã€‚
3. é‡‡ç”¨tsupè¿›è¡Œæ„å»º
    1. buildï¼šç”Ÿæˆdts
    2. build:fastï¼šä¸ç”Ÿæˆdts

è¿™æ˜¯å¯¹å¤§å®¶æ¯”è¾ƒé™Œç”Ÿçš„å¯èƒ½æ˜¯Vitestã€‚

Vitestæ˜¯ä¸€ä¸ªåŸºäºViteçš„å•å…ƒæµ‹è¯•æ¡†æ¶ï¼Œå®ƒå…·æœ‰ä»¥ä¸‹ä¼˜ç‚¹ï¼š

1. å¿«é€Ÿï¼šVitestè¢«è®¾è®¡ä¸ºé«˜æ•ˆçš„å•å…ƒæµ‹è¯•æ¡†æ¶ï¼Œèƒ½å¤Ÿå¿«é€Ÿæ‰§è¡Œæµ‹è¯•ç”¨ä¾‹ã€‚å®ƒåˆ©ç”¨Viteçš„å¿«é€Ÿæ„å»ºèƒ½åŠ›å’Œçƒ­é‡è½½åŠŸèƒ½ï¼Œæä¾›äº†å¿«é€Ÿçš„æµ‹è¯•åé¦ˆã€‚
2. ç®€å•æ˜“ç”¨ï¼šVitestæä¾›äº†ç®€æ´çš„APIå’Œæ¸…æ™°çš„æ–‡æ¡£ï¼Œä½¿å¾—ç¼–å†™å’Œè¿è¡Œæµ‹è¯•ç”¨ä¾‹å˜å¾—ç®€å•æ˜“æ‡‚ã€‚å®ƒä¸Viteçš„ç”Ÿæ€ç³»ç»Ÿç´§å¯†é›†æˆï¼Œå¯ä»¥æ— ç¼åœ°ä¸ç°æœ‰çš„Viteé¡¹ç›®é›†æˆã€‚
3. å¼ºå¤§çš„åŠŸèƒ½ï¼šVitestæ”¯æŒå¸¸è§çš„å•å…ƒæµ‹è¯•åŠŸèƒ½ï¼ŒåŒ…æ‹¬æ–­è¨€ã€æµ‹è¯•å¥—ä»¶ã€æµ‹è¯•ç»„ç»‡å’Œæµ‹è¯•è¦†ç›–ç‡ç­‰ã€‚å®ƒè¿˜æä¾›äº†ä¸°å¯Œçš„æ‰©å±•æ€§ï¼Œå¯ä»¥æ ¹æ®é¡¹ç›®çš„éœ€æ±‚è¿›è¡Œè‡ªå®šä¹‰é…ç½®å’Œæ‰©å±•ã€‚
4. ç¤¾åŒºæ”¯æŒï¼šVitestæ˜¯ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œæ‹¥æœ‰æ´»è·ƒçš„ç¤¾åŒºæ”¯æŒã€‚ä½ å¯ä»¥åœ¨GitHubä¸Šæ‰¾åˆ°å…¶ä»£ç åº“ï¼Œå¹¶å‚ä¸è®¨è®ºã€æé—®é—®é¢˜æˆ–è´¡çŒ®ä»£ç ã€‚

å®ƒä¸ªå¿«é€Ÿã€ç®€å•æ˜“ç”¨ä¸”åŠŸèƒ½å¼ºå¤§çš„å•å…ƒæµ‹è¯•æ¡†æ¶ï¼Œé€‚ç”¨äºä½¿ç”¨Viteæ„å»ºçš„é¡¹ç›®ã€‚å®ƒå’ŒNode.js test runnerå¾ˆåƒï¼Œä½ å¯ä»¥é€šè¿‡é˜…è¯»æ–‡æ¡£å’Œç¤ºä¾‹æ¥äº†è§£æ›´å¤šå…³äºVitestçš„ä¿¡æ¯ï¼Œå¹¶å¼€å§‹åœ¨ä½ çš„é¡¹ç›®ä¸­ä½¿ç”¨å®ƒã€‚

<aside>
ğŸ’¡ å­¦ä¼šä¸€é—¨ï¼Œå…¶ä»–å°±ä¼šè§¦ç±»æ—é€šï¼Œè¿™æ˜¯å­¦ä¹ çš„å¥½å¤„ã€‚

</aside>

## ç¤ºä¾‹

ç›®å½•

```tsx
$ tree example/ -I node_modules
example/
â”œâ”€â”€ package.json
â”œâ”€â”€ src
â”‚Â Â  â””â”€â”€ app.ts
â””â”€â”€ tsconfig.json

1 directory, 3 files
```

è¿™é‡Œä»¥koaä¸ºä¾‹

```tsx
import Koa from 'koa';
import { lib } from 'lib2';
const app = new Koa();

app.use(async (ctx) => {
  ctx.body = `Hello ${lib()}`;
});

app.listen(3000);
```

æ‰§è¡Œ

```tsx
$ pnpm example

> your-node-v20-menoreopo-project@ example /Users/alfred/workspace/npmstudy/my-menorepo
> npm run build && pnpm -F example dev

> build
> nx run-many -t build

    âœ”  nx run lib2:build  [existing outputs match the cache, left as is]
    âœ”  nx run lib:build  [existing outputs match the cache, left as is]

 â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”

 >  NX   Successfully ran target build for 2 projects (26ms)

   Nx read the output from the cache instead of running the command for 2 out of 2 tasks.

> example@1.0.0 dev /Users/alfred/workspace/npmstudy/my-menorepo/example
> tsx watch src/app.ts
```

è¦ç‚¹ï¼š

- å…ˆæ„å»ºlibå’Œlib2
- ç„¶åtsx watch src/app.ts

æ­¤æ—¶è®¿é—®[http://127.0.0.1:3000/](http://127.0.0.1:3000/)

![Untitled](img/Untitled%201.png)

å…¶å®ï¼Œåœ¨è¿™ç§Node.js Serveråº”ç”¨é‡Œï¼Œä¹Ÿæ˜¯å¯ä»¥è¿›è¡Œæµ‹è¯•çš„ï¼Œæ¯”å¦‚ä½¿ç”¨supertestæµ‹è¯•apiå’Œé¡µé¢ï¼Œç”šè‡³å¦‚æœæƒ³æè‡´ä¸€ç‚¹ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨Cypressåše2eæµ‹è¯•ã€‚

è¿™æ˜¯ä»ç®€ï¼Œå¹¶æ²¡æœ‰åŠ ï¼Œå¦‚æœå¤§å®¶æ„Ÿå…´è¶£ï¼Œå¯ä»¥ä½œä¸ºè¯¾åç»ƒä¹ ã€‚

## æ–°å¢æ¨¡å—

å¦‚æœæƒ³æ–°å¢ä¸€ä¸ªæ¨¡å—ï¼Œé‚£å°±é€šè¿‡ç®€å•çš„shellå‘½ä»¤å°±å¯ä»¥äº†ã€‚

```tsx
$ cp -rf packages/lib packages/lib3
```

æŸ¥çœ‹packagesä¸‹å†…å®¹ï¼Œä¼šå‘ç°å¤šäº†lib3

```tsx
$ tree packages/ -L 2
packages/
â”œâ”€â”€ lib
â”‚Â Â  â”œâ”€â”€ dist
â”‚Â Â  â”œâ”€â”€ node_modules
â”‚Â Â  â”œâ”€â”€ package.json
â”‚Â Â  â”œâ”€â”€ src
â”‚Â Â  â”œâ”€â”€ tsconfig.json
â”‚Â Â  â”œâ”€â”€ tsup.config.cjs
â”‚Â Â  â””â”€â”€ vitest.config.cjs
â”œâ”€â”€ lib2
â”‚Â Â  â”œâ”€â”€ dist
â”‚Â Â  â”œâ”€â”€ node_modules
â”‚Â Â  â”œâ”€â”€ package.json
â”‚Â Â  â”œâ”€â”€ src
â”‚Â Â  â”œâ”€â”€ tsconfig.json
â”‚Â Â  â”œâ”€â”€ tsup.config.cjs
â”‚Â Â  â””â”€â”€ vitest.config.cjs
â””â”€â”€ lib3
    â”œâ”€â”€ dist
    â”œâ”€â”€ node_modules
    â”œâ”€â”€ package.json
    â”œâ”€â”€ src
    â”œâ”€â”€ tsconfig.json
    â”œâ”€â”€ tsup.config.cjs
    â””â”€â”€ vitest.config.cjs

12 directories, 12 files
```

è¿™æ ·å…¶å®å·²ç»å¾ˆç®€å•äº†ã€‚å¦‚æœå¤§å®¶æƒ³åšæ›´å¤šå·¥ç¨‹åŒ–å†…å®¹ï¼Œå¯ä»¥è‡ªå·±å†™ä¸€ä¸ªè„šæ‰‹æ¶ã€‚

æŠ€æœ¯æ ˆæ¨èã€‚

1. cliè§£æï¼Œæ¨èä½¿ç”¨commanderæˆ–cac
2. è¾“å…¥é¡¹ï¼Œæ¨èä½¿ç”¨ [https://www.npmjs.com/package/inquirer](https://www.npmjs.com/package/inquirer)
3. æ¨¡ç‰ˆå¼•æ“æ¨èä½¿ç”¨handlebars
4. å¯ä»¥[**download-git-repo](https://www.npmjs.com/package/download-git-repo) æˆ–** [https://www.npmjs.com/package/dclone](dclone).

<aside>
ğŸ’¡ åœ¨å‰ç«¯å¼€å‘ä¸­ï¼Œè„šæ‰‹æ¶æ˜¯ä¸€ä¸ªç”¨äºå¿«é€Ÿæ­å»ºé¡¹ç›®ç»“æ„å’Œæä¾›åˆå§‹é…ç½®çš„å·¥å…·ã€‚å®ƒå¯ä»¥å¸®åŠ©å¼€å‘è€…å¿«é€Ÿåˆ›å»ºé¡¹ç›®ï¼Œå¹¶é›†æˆäº†ä¸€äº›å¸¸ç”¨çš„å·¥å…·ã€åº“å’Œæœ€ä½³å®è·µã€‚

</aside>

# è¡Œä¸šçœŸçŸ¥

åœ¨ https://github.com/npmstudy/your-node-v20-menoreopo-project é‡Œï¼Œæˆ‘ä»¬ç”¨åˆ°çš„æŠ€æœ¯æ ˆå¦‚ä¸‹ã€‚

```markdown
- [Tsup](https://tsup.egoist.dev/) as a TypeScript universal package.
- [Tsx](https://github.com/esbuild-kit/tsx) as a Node.js enhanced with esbuild to run TypeScript & ESM
- [Tsd](https://github.com/SamVerschueren/tsd) as type test runner
- [Tsdoc](https://tsdoc.org/) as document
- [PNPM](https://pnpm.io/workspaces) as workspace manager and package manager.
- [Vitest](https://vitest.dev/) as a test runner.
- [Size Limit](https://github.com/ai/size-limit) as a size limit plugin.
- [Prettier](https://prettier.io/) as a code formatter.
- [ESLint](https://eslint.org/) as a code linter.
- [NX](https://nx.dev) as cacheable operations.
- [Changesets](https://github.com/changesets/changesets/) as a way to manage changes and releases.
- [c8](https://www.npmjs.com/package/c8) as coverage
- [supertest](https://www.npmjs.com/package/supertest) as server test
- [cypress](https://www.cypress.io/) as e2e test
```

è¿è¡ŒTSçš„4ä¸ªï¼ˆå·²è®²è¿‡ï¼‰

1. tsup
2. tsx
3. tsd
4. tsdoc

æ¨¡å—å®‰è£…å’Œmenorepo

1. pnpm

æµ‹è¯•

1. Vitest
2. c8ï¼ˆå·²è®²è¿‡ï¼‰
3. supertest
4. cypress

å…¶ä»–

1. Size-limit
2. NX
3. ESLint
4. Prettier
5. Changesets

å…¶ä¸­ESLintå’ŒPrettierå‰ç«¯åŒå­¦éƒ½ç†Ÿæ‚‰ï¼Œè¿™é‡Œå°±ç»†è®²äº†ã€‚

- ESLintæ˜¯ä¸€ä¸ªç”¨äºJavaScriptå’ŒJSXä»£ç çš„é™æ€ä»£ç åˆ†æå·¥å…·ã€‚å®ƒå¯ä»¥å¸®åŠ©å¼€å‘è€…åœ¨ç¼–å†™ä»£ç çš„è¿‡ç¨‹ä¸­å‘ç°å¹¶ä¿®å¤æ½œåœ¨çš„é—®é¢˜ï¼Œä»¥ç¡®ä¿ä»£ç çš„è´¨é‡å’Œä¸€è‡´æ€§ã€‚
- Prettieræ˜¯ä¸€ä¸ªä»£ç æ ¼å¼åŒ–å·¥å…·ï¼Œç”¨äºè‡ªåŠ¨æ ¼å¼åŒ–ä»£ç ä»¥ä¿æŒä¸€è‡´çš„ä»£ç é£æ ¼ã€‚å®ƒæ”¯æŒå¤šç§ç¼–ç¨‹è¯­è¨€ï¼ŒåŒ…æ‹¬JavaScriptã€CSSã€HTMLã€JSONç­‰ã€‚Prettierå¯ä»¥å¸®åŠ©å¼€å‘è€…å¿«é€Ÿã€å‡†ç¡®åœ°æ ¼å¼åŒ–ä»£ç ï¼Œæé«˜ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚å®ƒå¯ä»¥ä¸å…¶ä»–ä»£ç æ£€æŸ¥å·¥å…·ï¼ˆå¦‚ESLintï¼‰é…åˆä½¿ç”¨ï¼Œä»¥ç¡®ä¿ä»£ç çš„è´¨é‡å’Œä¸€è‡´æ€§ã€‚

å®ƒä¿©æ˜¯VSCodeéå¸¸å¸¸è§çš„æ­æ¡£ã€‚

## Pnpm

åŒ…ç®¡ç†æ¼”è¿›å†å²ï¼Œå‚è€ƒ[https://zhuanlan.zhihu.com/p/582229306](https://zhuanlan.zhihu.com/p/582229306)ï¼Œå„ä¸ªåŒ…ç®¡ç†å™¨å¯¹æ¯”å¦‚ä¸‹ã€‚

pnpmåœ¨2018å¹´å‘å¸ƒï¼Œä½œä¸ºnpmçš„æ›´å¿«é€Ÿå’Œæ›´é«˜æ•ˆçš„æ›¿ä»£å“ã€‚

![Untitled](img/Untitled%202.png)

é€‰æ‹©pnpmçš„åŸå› ï¼Œç¬¬ä¸€ä¸ªå°±æ˜¯å®‰è£…é€Ÿåº¦å¿«ï¼Œå‚è€ƒå®˜æ–¹çš„[https://pnpm.io/benchmarks](https://pnpm.io/benchmarks)åŸºå‡†æµ‹è¯•æ•°æ®ã€‚

| è¡Œä¸º | ç¼“å­˜ | lockfile | node_modules | npm | **pnpm** | Yarn | Yarn PnP |
| --- | --- | --- | --- | --- | --- | --- | --- |
| install |  |  |  | 34.3s | 13.2s | 22.1s | 20.2s |
| install | âœ” | âœ” | âœ” | 2.5s | 1.6s | 695ms | n/a |
| install | âœ” | âœ” |  | 9.5s | 4.8s | 8.8s | 668ms |
| install | âœ” |  |  | 15.5s | 9.3s | 22.8s | 15.2s |
| install |  | âœ” |  | 19.3s | 9.8s | 8.9s | 670ms |
| install | âœ” |  | âœ” | 2.8s | 3.4s | 16s | n/a |
| install |  | âœ” | âœ” | 2.5s | 1.7s | 681ms | n/a |
| install |  |  | âœ” | 2.8s | 8.8s | 16.6s | n/a |
| update | n/a | n/a | n/a | 9.2s | 5.8s | 8.7s | 16.9s |

è¿˜æœ‰ä¸€äº›å…¶ä»–ç‰¹æ€§

![Untitled](img/Untitled%203.png)

pnpmä½¿ç”¨çš„æ˜¯npm version 2.xç±»ä¼¼çš„æ ‘å½¢ç»“æ„ï¼ŒåŒæ—¶ä½¿ç”¨.pnpm ä»¥å¹³é“ºçš„å½¢å¼å‚¨å­˜ç€æ‰€æœ‰çš„åŒ…ã€‚è¿™é‡Œçš„.pnmpä¸ºè™šæ‹Ÿå­˜å‚¨ç›®å½•ï¼Œè¯¥ç›®å½•é€šè¿‡`<package-name>@<version>`æ¥å®ç°ç›¸åŒæ¨¡å—ä¸åŒç‰ˆæœ¬ä¹‹é—´éš”ç¦»å’Œå¤ç”¨ï¼Œç”±äºå®ƒåªä¼šæ ¹æ®é¡¹ç›®ä¸­çš„ä¾èµ–ç”Ÿæˆï¼Œå¹¶ä¸å­˜åœ¨æå‡ï¼Œæ‰€ä»¥å®ƒä¸ä¼šå­˜åœ¨ä¹‹å‰æåˆ°çš„**Phantom dependencies**é—®é¢˜ï¼

ç„¶åä½¿ç”¨Store + Linkså’Œæ–‡ä»¶èµ„æºè¿›è¡Œå…³è”ã€‚ç®€å•è¯´pnpmæŠŠä¼šåŒ…ä¸‹è½½åˆ°ä¸€ä¸ªå…¬å…±ç›®å½•ï¼Œå¦‚æœæŸä¸ªä¾èµ–åœ¨ sotre ç›®å½•ä¸­å­˜åœ¨äº†è¯ï¼Œé‚£ä¹ˆå°±ä¼šç›´æ¥ä» store ç›®å½•é‡Œé¢å» hard-linkï¼Œé¿å…äº†äºŒæ¬¡å®‰è£…å¸¦æ¥çš„æ—¶é—´æ¶ˆè€—ï¼Œå¦‚æœä¾èµ–åœ¨ store ç›®å½•é‡Œé¢ä¸å­˜åœ¨çš„è¯ï¼Œå°±ä¼šå»ä¸‹è½½ä¸€æ¬¡ã€‚

é€šè¿‡Store + hard linkçš„æ–¹å¼ï¼Œä¸ä»…è§£å†³äº†é¡¹ç›®ä¸­çš„NPM doppelgangersé—®é¢˜ï¼Œé¡¹ç›®ä¹‹é—´ä¹Ÿä¸å­˜åœ¨è¯¥é—®é¢˜ï¼Œä»è€Œå®Œç¾è§£å†³äº†npm3+å’Œyarnä¸­çš„åŒ…é‡å¤é—®é¢˜ï¼

![Untitled](img/Untitled%204.png)

pnpmé™¤äº†å®‰è£…é€Ÿåº¦å¿«ï¼ŒèŠ‚çœç£ç›˜ç©ºé—´ï¼Œé¿å…å¹½çµä¾èµ–ç­‰ä¼˜åŒ–ï¼Œä¹Ÿå†…ç½®äº†å¯¹monorepoçš„æ”¯æŒã€‚ä½¿ç”¨èµ·æ¥æ¯”è¾ƒç®€å•ï¼Œåœ¨é¡¹ç›®æ ¹ç›®å½•ä¸­æ–°å»ºpnpm-workspace.yamlæ–‡ä»¶ï¼Œå¹¶å£°æ˜å¯¹åº”çš„å·¥ä½œåŒºå°±å¥½ã€‚

```tsx
$ cat pnpm-workspace.yaml
packages:
  - 'example'
  - 'packages/*'

```

å‰©ä¸‹çš„å°±æ˜¯è¿è¡Œæ—¶å¤„ç†ã€‚ä¹‹å‰nx run-manyè§£å†³äº†menorepoå­æ¨¡å—è¿è¡Œçš„é—®é¢˜ã€‚å¾ˆå¤šæ—¶å€™æˆ‘ä»¬éœ€è¦åœ¨æ ¹ç›®å½•æ‰§è¡ŒæŸä¸ªé¡¹ç›® çš„æ„å»ºè„šæœ¬ï¼Œéœ€è¦é€šè¿‡â€”filteræˆ–-Fè¿‡æ»¤ä¹‹åï¼Œå†æ‰§è¡Œï¼Œç¤ºä¾‹å¦‚ä¸‹ã€‚

```tsx
$ pnpm -F example dev
```

ä»¥ä¸Šéƒ½æ˜¯pnpmçš„æœ‰ç‚¹ï¼Œå…¶å®pnpmçš„æ¼”è¿›è¿˜æ˜¯æ¯”è¾ƒå¿«çš„ï¼Œæ¯”å¦‚pnpm v7å’Œpnpm v8ç‰ˆæœ¬å·®å¼‚è¿˜æ˜¯æ¯”è¾ƒå¤§çš„ï¼Œä¸”ä¸å®Œå…¨å…¼å®¹ã€‚ä½†æ•´ä¸ªç¤¾åŒºæ˜¯æ¯”è¾ƒæ´»è·ƒçš„ï¼Œ

<aside>
ğŸ’¡ éƒ½è¯´Node.jså’Œå‰ç«¯å¤æ‚ï¼Œå…¶å®æ˜¯èƒŒåå·¥ç¨‹å¤æ‚åº¦å¯¼è‡´çš„ï¼Œå¦‚æœæ²¡æœ‰è¿™ä¹ˆå¤šä¾èµ–ï¼Œè¿™ä¹ˆå¤šç‰ˆæœ¬ï¼Œä¹Ÿä¸ä¼šå‡ºç°å¹»å½±ä¾èµ–è¿™æ ·çš„é—®é¢˜ã€‚å…¶å®ï¼Œå¯¹ç”¨çš„äººæ¥è¯´æ— æ„Ÿçš„ï¼Œæˆ‘å°±ç”¨pnpm v8ï¼Œåƒå…¶ä»–ç¤¾åŒºä¸€æ ·ï¼Œä¹Ÿæ²¡é—®é¢˜çš„ã€‚çœŸæ­£çš„é—®é¢˜æ˜¯Node.jså’Œå‰ç«¯å˜åŒ–å¤ªå¿«ï¼Œä½ åœ¨è¾ƒçŸ­æ—¶é—´å†…ï¼Œæ€»å¯èƒ½ä¼šé‡åˆ°pnpm v7çš„ä»£ç ï¼Œç”šè‡³äº’ç›¸åˆ‡æ¢ã€‚

</aside>

## Vitest

- **A Vite-native unit test framework.**

    **It's fast!**


ä¼˜ç‚¹ï¼š

1. åŸºäºviteæœºåˆ¶ï¼Œæ€§èƒ½æä½³ï¼Œæ¯”jestå¿«å¾ˆå¤šï¼Œ
2. å¯¹esmæ”¯æŒæå¥½
3. å…¼å®¹jest api
4. å¾ˆå¤šæŠ€æœ¯é€‰å‹ä¹Ÿéƒ½æ˜¯éå¸¸æ£’ï¼Œæ¯”å¦‚tinypoolï¼Œéƒ½æ˜¯å¾ˆç»å…¸çš„ã€‚

å¦‚æœæˆ‘ä»¬æƒ³è¦ä»è¯·æ±‚å¼€å§‹æ¥æµ‹è¯•nodeæœåŠ¡æ¥å£è¿”å›çš„æ•°æ®æ˜¯å¦æ­£å¸¸ï¼Œä¹Ÿå°±æ˜¯è¯´è¿›è¡Œä¸€ä¸ªæ•´ä½“æ€§æµ‹è¯•ï¼Œé‚£ä¹ˆ superTest å°±æ˜¯ä¸€ä¸ªéå¸¸å¥½çš„é€‰æ‹©ã€‚superTestå¯ä»¥å¸®åŠ©æˆ‘ä»¬å»è¯·æ±‚æœ¬åœ° koa æˆ–è€… expressè¿™ç±»webæ¡†æ¶æ‰€ç¼–å†™çš„è·¯ç”±æ¥å£ï¼Œè€Œä¸”å¯¹æ¥å£è¿”å›çš„çŠ¶æ€ç ã€æ•°æ®ç­‰è¿›è¡Œæ–­è¨€æ ¡éªŒã€‚

å®ƒæœ¬èº«ä¸ä¾èµ–ä»»ä½•æµ‹è¯•æ¡†æ¶ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç›´æ¥æŠŠå®ƒä¸¢åˆ°mochaçš„æµ‹è¯•ç”¨ä¾‹ä¸­æ‰§è¡Œï¼š

å…ˆå†™ä¸€ä¸ªç®€å•çš„Koaçš„Hello worldã€‚è§app.js

```tsx
import Koa from "koa";
const app = new Koa();

// response
app.use((ctx) => {
  ctx.body = "Hello Koa";
});

export default app;
```

å†å†™ä¸€ä¸ªæµ‹è¯•è„šæœ¬ï¼Œrun.js

```tsx
import app from "./index.js";

app.listen(3000);
```

æ­¤æ—¶ï¼Œæ‰§è¡Œnode run.jså°±å¯ä»¥å¯åŠ¨æœåŠ¡äº†ã€‚ç„¶åæˆ‘ä»¬çœ‹ä¸€ä¸‹æµ‹è¯•å¦‚ä½•ç¼–å†™ã€‚

```tsx
import { expect, test } from "vitest";
import supertest from "supertest";
import app from "./index.js";

test("koa app", async () => {
  const res = await supertest(app.callback()).get("/");

  expect(res.type).toEqual("text/plain");
  expect(res.status).toEqual(200);
  expect(res.text).toEqual("Hello Koa");
});
```

è¿™ä¸ªä»£ç å’Œæˆ‘ä»¬åœ¨Node.js v20çš„test runneré‡Œå‡ ä¹æ˜¯ä¸€æ¨¡ä¸€æ ·çš„ã€‚é€šè¿‡ä¸‹é¢å‘½ä»¤å³å¯è¿è¡Œæµ‹è¯•ã€‚

```tsx
$ npx vitest run

 RUN  v0.34.6 /Users/alfred/workspace/npmstudy/vitest-with-supertest

 âœ“ index.test.js (1)
   âœ“ koa app

 Test Files  1 passed (1)
      Tests  1 passed (1)
   Start at  11:56:53
   Duration  232ms (transform 17ms, setup 0ms, collect 69ms, tests 8ms, environment 0ms, prepare 44ms)
```

è¯´æ˜ã€‚

- vitestä¸å¸¦runå‚æ•°ï¼Œæ˜¯watchè¿è¡Œæ¨¡å¼ï¼Œå’Œjestç±»ä¼¼
- vitestå¸¦runå‚æ•°ï¼Œæ˜¯å•æ¬¡è¿è¡Œæ¨¡å¼

## Cypress

å®‰è£…

```tsx
$ npm install cypress --save-dev --registry=https://registry.npmmirror.com
```

é€šè¿‡npx cypress openæ‰“å¼€ã€‚

```tsx
$ npx cypress open
It looks like this is your first time using Cypress: 13.3.0

âœ”  Verified Cypress! /Users/alfred/Library/Caches/Cypress/13.3.0/Cypress.app

Opening Cypress...

DevTools listening on ws://127.0.0.1:54097/devtools/browser/dc560ea2-0aad-47a4-9461-1e160b19a5a3
```

![Untitled](img/Untitled%205.png)

![Untitled](img/Untitled%206.png)

![Untitled](img/Untitled%207.png)

![Untitled](img/Untitled%208.png)

ä¿®æ”¹ä»£ç ï¼Œæ‰‹åŠ¨æ‰§è¡Œnode run.jså¯åŠ¨æœåŠ¡ã€‚

```tsx
describe("template spec", () => {
  it("passes", () => {
    cy.visit("http://127.0.0.1:3000");
    cy.contains("Hello Koa");
  });
});
```

![Untitled](img/Untitled%209.png)

ä¸ºäº†ç®€åŒ–æ“ä½œï¼Œæˆ‘ä»¬æŠŠå¯åŠ¨æœåŠ¡æ”¾åˆ°cypress.config.jsé‡Œã€‚

```tsx
import { defineConfig } from "cypress";
import app from "./index.js";
export default defineConfig({
  e2e: {
    setupNodeEvents(on, config) {
      // implement node event listeners here
      on("before:run", async (details) => {
        /* ... */
        await app.listen(3000);
      });
    },
  },
});
```

æ­¤æ—¶ï¼Œæ‰§è¡Œç»“æœå¦‚ä¸‹ã€‚

```tsx
$ npx cypress run

DevTools listening on ws://127.0.0.1:61755/devtools/browser/0a2f2716-10cb-49b9-a2c9-5163469574e9

====================================================================================================

  (Run Starting)

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Cypress:        13.3.0                                                                         â”‚
  â”‚ Browser:        Electron 114 (headless)                                                        â”‚
  â”‚ Node Version:   v20.6.1 (/Users/alfred/.nvm/versions/node/v20.6.1/bin/node)                    â”‚
  â”‚ Specs:          1 found (spec.cy.js)                                                           â”‚
  â”‚ Searched:       cypress/e2e/**/*.cy.{js,jsx,ts,tsx}                                            â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  Running:  spec.cy.js                                                                      (1 of 1)

  template spec
    âœ“ passes (27ms)

  1 passing (47ms)

  (Results)

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Tests:        1                                                                                â”‚
  â”‚ Passing:      1                                                                                â”‚
  â”‚ Failing:      0                                                                                â”‚
  â”‚ Pending:      0                                                                                â”‚
  â”‚ Skipped:      0                                                                                â”‚
  â”‚ Screenshots:  0                                                                                â”‚
  â”‚ Video:        false                                                                            â”‚
  â”‚ Duration:     0 seconds                                                                        â”‚
  â”‚ Spec Ran:     spec.cy.js                                                                       â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

====================================================================================================

  (Run Finished)

       Spec                                              Tests  Passing  Failing  Pending  Skipped
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ âœ”  spec.cy.js                                42ms        1        1        -        -        - â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    âœ”  All specs passed!                         42ms        1        1        -        -        -
```

Cypresså†™e2eæµ‹è¯•è¿˜æ˜¯éå¸¸ç®€å•çš„ï¼Œå®ƒä¹Ÿæ”¯æŒæµ‹è¯•è¦†ç›–ç‡ï¼Œä¹Ÿå¯ä»¥ç”Ÿäº§reporterï¼Œå’Œæˆ‘ä»¬åœ¨ä¸Šä¸€ç« èŠ‚å­¦åˆ°çš„c8ç±»ä¼¼ï¼Œå¤§å®¶å¦‚æœæ„Ÿå…´è¶£ä¹Ÿå¯ä»¥è‡ªå·±å®ç°ä¸€ä¸‹ã€‚

é™¤æ­¤ä¹‹å¤–ï¼ŒCypressè¿˜æ”¯æŒç»„ä»¶çº§åˆ«æµ‹è¯•ï¼Œå¯ä»¥è¯´åˆæ˜¯å¡«è¡¥äº†ä¸€å—ç©ºç™½ï¼Œæ„ä¹‰éå‡¡ï¼Œå¯¹äºå¼€å‘ç»„ä»¶åº“æ¥è¯´ï¼Œä¹Ÿæ˜¯å¿…ä¸å¯å°‘çš„åŠŸèƒ½ã€‚

## Size-limit

size-limit æ˜¯ä¸€ä¸ªé˜²æ­¢ JavaScript åº“è†¨èƒ€çš„å·¥å…·ï¼Œç”¨äºæ§åˆ¶æ–‡ä»¶åŒ…çš„å¤§å°ã€‚å¦‚æœä¸å°å¿ƒæ·»åŠ äº†å¤§é‡çš„ä¾èµ–å…³ç³»ï¼Œsize-limit ä¼šå¼•å‘é”™è¯¯ã€‚

limit-size æ˜¯ä¸€ä¸ªç”¨äºæ§åˆ¶æ–‡ä»¶åŒ…å¤§å°çš„å·¥å…·ï¼Œå®ƒå¯ä»¥è¯»å–æ–‡ä»¶çš„å¤§å°ï¼Œå¹¶ä¸è®¾ç½®çš„æ–‡ä»¶å¤§å°è¿›è¡Œæ¯”è¾ƒã€‚

![Untitled](img/Untitled%2010.png)

ä½¿ç”¨GitHubæ“ä½œSize Limitå°†åœ¨æ‹‰å–è¯·æ±‚è®¨è®ºä¸­ä½œä¸ºè¯„è®ºå‘å¸ƒæ†ç»‘å¤§å°æ›´æ”¹ã€‚

![Untitled](img/Untitled%2011.png)

ä¹Ÿå¯ä»¥ç»“åˆhttps://github.com/statoscope/statoscope è¿›è¡Œåˆ†æã€‚

Â [Statoscope: A Course Of Intensive Therapy For Your Bundle](https://www.smashingmagazine.com/2022/02/statoscope-course-intensive-therapy-bundle/).

![Untitled](img/Untitled%2012.png)

## Nx

<aside>
ğŸ’¡ Nrwl(å¼€æºæ„å»ºç³»ç»ŸNXèƒŒåçš„å…¬å¸)å·²ç»æ¥ç®¡äº†Lernaã€‚NXæ˜¯ä¸€ä¸ªç”±å‰è°·æ­Œå‘˜å·¥å¼€å‘çš„æ„å»ºç³»ç»Ÿï¼Œå®ƒåˆ©ç”¨äº†è°·æ­Œå†…éƒ¨å·¥å…·ä½¿ç”¨çš„è®¸å¤šæŠ€æœ¯ã€‚Lerna v5æ˜¯è¿™ç§æ–°ç®¡ç†æ–¹å¼ä¸‹çš„ç¬¬ä¸€ä¸ªç‰ˆæœ¬ï¼Œå®ƒæ›´æ–°äº†è¿‡æ—¶çš„åŒ…ï¼Œå¹¶å¼€å§‹å¯¹å­˜å‚¨åº“æœ¬èº«è¿›è¡Œä¸€äº›æ¸…ç†ã€‚ä»V5.1+å¼€å§‹ï¼ŒLernaæä¾›äº†é›†æˆNXçš„æ–°å¯èƒ½æ€§ï¼Œå¹¶å°†è®¸å¤šä»»åŠ¡è°ƒåº¦å·¥ä½œæ¨è¿Ÿåˆ°NXã€‚

</aside>

åœ¨ä½¿ç”¨Menorepoæ—¶ï¼Œä½ ä¸€å®šå¬è¯´è¿‡ Nxã€‚ç®€è€Œè¨€ä¹‹ï¼ŒNx å¯ä»¥åŠ å¿«å’Œç®€åŒ–ä¸Menorepoçš„å·¥ä½œï¼Œå¹¶æä¾›æœ‰ç”¨çš„å®ç”¨ç¨‹åºã€‚

å®˜æ–¹ä»‹ç»ï¼š

> Nxæ˜¯ä¸€ä¸ªæ™ºèƒ½ã€å¿«é€Ÿå’Œå¯æ‰©å±•çš„æ„å»ºç³»ç»Ÿï¼Œå…·æœ‰ä¸€æµçš„Monorepoæ”¯æŒå’Œå¼ºå¤§çš„é›†æˆã€‚
>

Nxçš„ç›®æ ‡æ˜¯ï¼š

- åŠ å¿«ä½ çš„å‰ç«¯é¡¹ç›®å·¥ç¨‹åŒ–
- æä¾›ä¸€æµçš„å¼€å‘ä½“éªŒ

å¤§éƒ¨åˆ†æƒ…å†µéœ€è¦äº†è§£çš„å°±æ˜¯ä¸‹é¢6ä¸ªæŒ‡ç‚¹å°±å¤Ÿäº†ã€‚

- nx run-many
- dependency graph + nx affected
- nx-enforce-module-boundaries es-linting
- computation cache
- nx cloud
- buildable libs

nxä¼šè‡ªåŠ¨å¼•å…¥ä¸Šä¸€æ¬¡buildçš„cacheç¼“å­˜ï¼Œä»è€ŒåŠ å¿«ç¼–è¯‘é€Ÿåº¦.åœ¨[How Caching Works](https://nx.dev/concepts/how-caching-works)è¿™ç¯‡æ–‡ç« ä¸­éå¸¸è¯¦ç»†åœ°è¯´æ˜äº† nx ç¼“å­˜æ„å»ºç»“æœçš„æœºåˆ¶ï¼š

nx ä¼šè®¡ç®—å½“å‰æ‰§è¡Œçš„ target çš„ Hash ä½œä¸º cache keyï¼Œåœ¨ target æ‰§è¡Œå®ŒæˆåæŠŠæ„å»ºè¾“å‡ºï¼ˆåŒ…æ‹¬ç»ˆç«¯è¾“å‡ºã€æ„å»ºç»“æœæ–‡ä»¶ï¼‰ä½œä¸ºç¼“å­˜å†…å®¹å­˜å‚¨èµ·æ¥ã€‚

![Untitled](img/Untitled%2013.png)

æœ€å¸¸ç”¨çš„åŠ¨ä½œ

- å°†æ‰€æœ‰çš„å­é¡¹ç›®ç»Ÿä¸€æ‰“åŒ…ç¼–è¯‘ï¼Œå‘½ä»¤:`npx nx run-many --target=build`
- å¦‚æœä¸éœ€è¦ä½¿ç”¨cacheç¼“å­˜ï¼Œå¯ä»¥ä½¿ç”¨å‘½ä»¤:`npx nx run-many --target=build --skip-nx-cache`
- å¦‚æœéœ€è¦æŸ¥çœ‹å½“å‰å­é¡¹ç›®ä¾èµ–çš„é¡¹ç›®æ˜¯å¦è¢«ä¿®æ”¹ï¼Œå¯ä»¥ä½¿ç”¨å‘½ä»¤ï¼š`npx nx affected --target=buil`d
- å¦‚æœéœ€è¦æŸ¥çœ‹å½“å‰å­é¡¹ç›®ä¾èµ–çš„å›¾ï¼Œå¯ä»¥ä½¿ç”¨å‘½ä»¤ï¼š`npx nx graph`

æ¯”å¦‚ä¾èµ–å¦‚ä¸‹ã€‚

```tsx
$ pnpm project-graph

> your-node-v20-menoreopo-project@ project-graph /Users/alfred/workspace/npmstudy/your-node-v20-menoreopo-project
> nx graph

 >  NX   Project graph started at http://127.0.0.1:4211/projects
```

![Untitled](img/Untitled%2014.png)

nxé™¤äº†æœ¬åœ°æ¢æˆï¼Œå…¶å®è¿˜æ”¯æŒäº‘æœåŠ¡ï¼ˆremote cacheï¼‰ã€‚å³nx.appï¼Œå¦‚æœçœŸçš„å¯¹ci/cdæœ‰æå¼ºçš„éœ€æ±‚ï¼Œå…¶å®ä¹Ÿæ˜¯å¯ä»¥è€ƒè™‘é€‰æ‹©çš„ã€‚

![Untitled](img/Untitled%2015.png)

åœ¨https://github.com/npmstudy/your-node-v20-menoreopo-project é¡¹ç›®é‡Œï¼Œæˆ‘ä»¬å…¶å®åªç”¨äº†éå¸¸ç®€å•çš„npm nx run-many

```tsx
  	"build": "nx run-many -t build",
    "build:fast": "nx run-many -t build:fast",
    "dev": "nx run-many -t dev",
    "test": "nx run-many -t test",
```

è™½ç„¶å¤šäº†ä¸€ä¸ªnxæ¨¡å—ï¼Œä½†æ‰§è¡Œçš„æ—¶å€™èƒ½å¤Ÿåˆ©ç”¨æœ¬åœ°ç¼“å­˜ï¼ŒåŠ å¿«æ‰“åŒ…ã€æµ‹è¯•é€Ÿåº¦ï¼Œå·²ç»æ˜¯éå¸¸å¥½çš„äº‹å„¿ã€‚

## Changesets

Changesets æ˜¯ä¸€ä¸ªç”¨äº Monorepo é¡¹ç›®ä¸‹ç‰ˆæœ¬ä»¥åŠ Changelog æ–‡ä»¶ç®¡ç†çš„å·¥å…·ã€‚ç›®å‰ä¸€äº›æ¯”è¾ƒç«çš„ Monorepo ä»“åº“éƒ½åœ¨ä½¿ç”¨è¯¥å·¥å…·è¿›è¡Œé¡¹ç›®çš„å‘åŒ…ä¾‹å¦‚ pnpmã€mobx ç­‰ã€‚

changesets ä¸»è¦å…³å¿ƒ monorepo é¡¹ç›®ä¸‹å­é¡¹ç›®ç‰ˆæœ¬çš„æ›´æ–°ã€changelog æ–‡ä»¶ç”Ÿæˆã€åŒ…çš„å‘å¸ƒã€‚ä¸€ä¸ª changeset æ˜¯ä¸ªåŒ…å«äº†åœ¨æŸä¸ªåˆ†æ”¯æˆ–è€… commit ä¸Šæ”¹åŠ¨ä¿¡æ¯çš„ md æ–‡ä»¶ï¼Œå®ƒä¼šåŒ…å«è¿™æ ·ä¸€äº›ä¿¡æ¯:

- éœ€è¦å‘å¸ƒçš„åŒ…
- åŒ…ç‰ˆæœ¬çš„æ›´æ–°å±‚çº§(éµå¾ª semver è§„èŒƒ)
- CHANGELOG ä¿¡æ¯

åœ¨ changesets å·¥ä½œæµä¼šå°†å¼€å‘è€…åˆ†ä¸ºä¸¤ç±»äººï¼Œä¸€ç±»æ˜¯é¡¹ç›®çš„ç»´æŠ¤è€…ï¼Œè¿˜æœ‰ä¸€ç±»ä¸ºé¡¹ç›®çš„å¼€å‘è€…ï¼Œä¸¤è€…çš„èŒè´£å¯ä»¥é€šè¿‡å¦‚ä¸‹æµç¨‹å›¾å¾ˆç®€æ´çš„è¡¨ç¤ºå‡ºæ¥:

![Untitled](img/Untitled%2016.png)

æ ¹æ®ä¸Šå›¾ï¼Œ changesets çš„å·¥ä½œæµç¨‹æ˜¯è¿™æ ·ï¼šå¼€å‘è€…åœ¨ Monorepo é¡¹ç›®ä¸‹è¿›è¡Œå¼€å‘ï¼Œå¼€å‘å®Œæˆåï¼Œç»™å¯¹åº”çš„å­é¡¹ç›®æ·»åŠ ä¸€ä¸ª changesets æ–‡ä»¶ã€‚é¡¹ç›®çš„ç»´æŠ¤è€…åé¢ä¼šé€šè¿‡ changesets æ¥æ¶ˆè€—æ‰è¿™äº›æ–‡ä»¶å¹¶è‡ªåŠ¨ä¿®æ”¹æ‰å¯¹åº”åŒ…çš„ç‰ˆæœ¬ä»¥åŠç”Ÿæˆ CHANGELOG æ–‡ä»¶ï¼Œæœ€åå°†å¯¹åº”çš„åŒ…å‘å¸ƒå‡ºå»ã€‚

å¸¸ç”¨çš„å‘½ä»¤åªæœ‰addã€versionã€publish

![Untitled](img/Untitled%2017.png)

# å¦‚ä½•å­¦ä¹ 

## å¼€æº

ã€Š*å¤§æ•™å ‚ä¸é›†å¸‚*ã€‹æ˜¯å¼€æºè¿åŠ¨çš„ã€Šåœ£ç»ã€‹ï¼Œé¢ è¦†äº†ä¼ ç»Ÿçš„è½¯ä»¶å¼€å‘æ€è·¯ï¼Œå½±å“äº†æ•´ä¸ªè½¯ä»¶å¼€å‘é¢†åŸŸã€‚

![Untitled](img/Untitled%2018.png)

æˆ‘æ‰€æ€»ç»“çš„4tï¼ˆtsxã€tsupã€tsdocã€tsdï¼‰ï¼Œå…¶å®éƒ½æ˜¯æˆ‘åœ¨å„ç§å¼€æºé¡¹ç›®é‡Œå­¦çš„ï¼Œæˆ‘ä¼šå…»æˆä¸€ä¸ªä¹ æƒ¯ï¼Œçœ‹åˆ°ä¸€ä¸ªå¥½çš„é¡¹ç›®ï¼Œé¦–å…ˆçœ‹package.jsonï¼Œé™¤äº†ä¾èµ–åŒ…ï¼Œè¿˜æœ‰æ„å»ºç›¸å…³ï¼Œéƒ½æ˜¯æŠ€å·§ã€‚

å¼€æºæ˜¯æˆ‘å­¦ä¹ çš„æœ€å¥½çš„é€”å¾„ã€‚å¦‚æœä¸æ‡‚ï¼Œè¿˜å¯ä»¥å»æissueï¼Œå†åé¢å°±å¯ä»¥è‡ªå·±åˆ›é€ ä¸€äº›æ›´æœ‰è¶£é¡¹ç›®ã€‚

æˆ‘ä¹‹æ‰€ä»¥äº†è§£tsdï¼Œæ˜¯å› ä¸ºé˜…è¯»fastifyæºç ï¼Œç¿»å®ƒçš„package.jsonï¼š[https://github.com/fastify/fastify/blob/main/package.json#L184](https://github.com/fastify/fastify/blob/main/package.json#L184)ã€‚

å…¶å®è¿˜æœ‰æ›´åŠ è½»é‡çº§çš„https://github.com/mrazauskas/tsd-liteï¼Œæˆ‘æ˜¯åœ¨ç¿»jestä¸­expectæ¨¡å—çš„æ—¶å€™æ‰¾è§çš„ï¼Œåœ°å€[https://github.com/jestjs/jest/blob/main/packages/expect/package.json](https://github.com/jestjs/jest/blob/main/packages/expect/package.json)ã€‚

å¦å¤–ï¼Œã€Šå¼€æ”¾å¼åä½œ:å¼€æºè½¯ä»¶çš„ç”Ÿäº§ä¸ç»´æŠ¤ã€‹ä¹Ÿæ˜¯ä¸é”™çš„ï¼Œå€¼å¾—ä¸€è¯»ã€‚

## åˆ»æ„ç»ƒä¹ 

æˆ‘è®¤åŒè¿™æœ¬ä¹¦çš„è§‚ç‚¹

<aside>
ğŸ’¡ åˆ»æ„ç»ƒä¹ æ˜¯ä¸€ç§æœ‰ç›®çš„çš„ç»ƒä¹ ï¼šâ‘ å®šä¹‰æ˜ç¡®çš„ç‰¹å®šç›®æ ‡ï¼Œç§¯è·¬æ­¥ä»¥è‡´åƒé‡Œï¼›â‘¡ä¿æŒä¸“æ³¨ï¼ŒæŠŠå…¨éƒ¨æ³¨æ„åŠ›é›†ä¸­äºä½ çš„ä»»åŠ¡ä¸Šï¼›â‘¢éœ€è¦åé¦ˆï¼Œåé¦ˆä¼šå¸®ä½ ææ¸…æ¥šå“ªæ–¹é¢ä¸è¶³ï¼Œç¦»ç›®æ ‡æœ‰å¤šè¿œï¼›â‘£èµ°å‡ºèˆ’é€‚åŒºï¼Œä¸èµ°å‡ºèˆ’é€‚åŒºæ°¸è¿œæ— æ³•è¿›æ­¥ã€‚

</aside>

![Untitled](img/Untitled%2019.png)

ã€Šè¿·èŒ«æ—¶å­¦ä¹  Node.js æœ€å¥½çš„æ–¹æ³•ã€‹è¿™ç¯‡æ–‡ç« æåˆ°çš„è§‚ç‚¹å¤§å®¶å¯ä»¥è¯•è¯•ã€‚

> ä»Šå¤©å°å¼Ÿè¿‡æ¥æ‰¾æˆ‘ï¼Œè¯´è¿·èŒ«ï¼Œæˆ‘å‘Šè¯‰ä»–ä¸€ä¸ªå¯†æ³•ï¼šä¸€å¤©çœ‹ 10 ä¸ª npm æ¨¡å—ï¼ŒåšæŒä¸€å¹´å°±æ˜¯ 3000+ï¼ŒæŒ‰æ­£å¸¸å·¥ä½œéœ€è¦ï¼Œè¶…è¿‡ 200 ä¸ªéƒ½å¾ˆå‰å®³äº†ã€‚
>

å¯å‘

1. æºç å­¦ä¹ å¤šäº†ï¼Œåº”ç”¨èµ·æ¥ä¿¡æ‰‹æ‹ˆæ¥ã€‚
2. é˜…è¯»æ–‡æ¡£ä¸­ï¼Œå¤§ä½¬çš„ç»éªŒç»™äººå¯å‘ã€‚
3. æœ€éš¾çš„ä¸æ˜¯ä¸‹å†³å¿ƒï¼Œè€Œæ˜¯åšæŒï¼Œè¿™æ˜¯æœ€å€¼å¾—è‡ªè±ªçš„ã€‚

å‚è€ƒè¿™ç¯‡æ–‡ç« [https://mp.weixin.qq.com/s/Jfmu1Z8G3plgUgP8XdcqqQ](https://mp.weixin.qq.com/s/Jfmu1Z8G3plgUgP8XdcqqQ)ã€‚

## æŒ è‡ªå·±çš„ç—’

reworkæ˜¯ä¸€æœ¬ç»å…¸çš„ä¹¦ï¼Œæˆ‘æœ€å–œæ¬¢çš„è§‚ç‚¹å°±æ˜¯æŒ è‡ªå·±çš„ç—’ï¼Œè‡ªå·±éœ€è¦ä»€ä¹ˆï¼Œå°±åŠ¨æ‰‹å†™ä»€ä¹ˆã€‚å¦‚æœè‡ªå·±éƒ½ä¸éœ€è¦ï¼Œåˆ«äººçœŸçš„ä¼šéœ€è¦å—ï¼Ÿä¸ä¸€å®šçš„ã€‚

å°¤å…¶æ˜¯å¯¹åˆå­¦è€…æ¥è¯´ï¼Œä»è‡ªå·±æ„Ÿå…´è¶£çš„åœ°æ–¹å¼€å§‹ï¼Œæ˜¯æœ€å¥½çš„é€‰æ‹©ã€‚

![Untitled](img/Untitled%2020.png)

vitestä½œè€…antfuï¼Œå°±æ˜¯ä¸€ä¸ªç–¯å­ï¼Œvitestæ—©æœŸæˆ‘å°±å…³æ³¨äº†ï¼Œæ¯å¤©æäº¤ä»£ç é‡æå…¶å¤§ï¼Œæ„Ÿè§‰ä¸ºäº†è¿™ä¸ªé¡¹ç›®å¯ä»¥ä¸çœ ä¸ä¼‘ï¼Œç²¾ç¥å¯å˜‰ã€‚ä»–çš„ä¸€ç¯‡å…³äºè‡ªå·±ä¸å¼€æºçš„æ•…äº‹ï¼Œä»¥å‰ªç¾Šæ¯›è‡ªå–»ï¼Œa)å‘ç°é—®é¢˜b)è§£å†³é—®é¢˜c)ç‚¹åˆ°ä¸ºæ­¢d)æŒ è‡ªå·±çš„ç—’ï¼Œä¹Ÿæ˜¯éå¸¸ä¸é”™çš„ï¼Œæ¨èé˜…è¯»[https://antfu.me/posts/about-yak-shaving-zh](https://antfu.me/posts/about-yak-shaving-zh)ã€‚

# å°ç»“

ä½œä¸ºä¸€é—¨å…¥é—¨è¯¾ç¨‹ï¼Œæˆ‘å¸Œæœ›å®ƒçš„å®šä½å¦‚ä¸‹ã€‚

1. ä»¥tså’Œnode v20å…¥é—¨ï¼Œè®©å¤§å®¶æœ‰ä¸€ä¸ªåŸºæœ¬æ¦‚å¿µã€‚
2. é€šè¿‡ç¬¬ä¸€ä¸ªtsç¼–å†™çš„nodeé¡¹ç›®ï¼Œè®²è§£äº†å¼€å‘è¿‡ç¨‹ä¸­ä»å¼€å‘ã€è°ƒè¯•ã€æµ‹è¯•ã€å‘å¸ƒå››ä¸ªæ–¹é¢è¿›è¡Œè®²è§£ï¼Œå…¶ä¸­è°ƒè¯•å’Œæµ‹è¯•æ˜¯å¼€å‘è¿‡ç¨‹ä¸­æœ€å¸¸ç”¨çš„åŠŸèƒ½ï¼Œæ‰€ä»¥å•ç‹¬ç« èŠ‚è¿›è¡Œè®²è§£ã€‚
3. è®²è§£nodejs + ts åœ¨å¤šæ¨¡å—å¼€å‘åœºæ™¯ä¸‹çš„ç”¨æ³•ï¼Œä»¥åŠæœ€ä½³å®è·µã€‚

å¸Œæœ›æœ¬è¯¾ç¨‹èƒ½å¤Ÿåšåˆ°æ—¢å®ç”¨ï¼Œåˆèƒ½å¼€çœ¼ç•Œã€‚

è¯¾åç»ƒä¹ ï¼Œæœ‰åŠ©æ•™å¸®å¿™Review

1. è‡ªå·±é€šè¿‡Github Actionç¼–å†™CDç¤ºä¾‹
2. è‡ªå·±å‚è€ƒå½“å‰é¡¹ç›®ï¼Œå†™Cliè„šæ‰‹æ¶
3. è¡¥å……supertestæµ‹è¯•
4. è¡¥å……cypressæµ‹è¯•

éœ€è¦æ·±å…¥å­¦ä¹ çš„å†…å®¹ã€‚å…³æ³¨npmstudyè´¦å·ï¼Œä¼šæŒç»­æ›´æ–°æ•™ç¨‹ã€‚

1. Node.js v20ç³»ç»Ÿå­¦ä¹ 
2. TSå„ç§è¦ç‚¹å­¦ä¹ å’Œå®ç°ï¼Œæœ€å¥½ç»“åˆWebæ¡†æ¶å®ç°
3. å­¦ä¹ pnpmã€changesetã€vitestç­‰æ¨¡å—å¼€å‘æŠ€å·§
4. AIæ—¶ä»£Nodeå…¨æ ˆåº”ç”¨å¼€å‘